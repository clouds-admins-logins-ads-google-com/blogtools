<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Subdomain Finder (OTX)</title>
  <style>
:root{
  --bg:#09090b; 
  --card:#121212; 
  --muted:#9ca3af; 
  --accent:#3b82f6; 
  --ink:#f3f4f6;
  --hover:#1f2937;
  --border:#1f2937;
}
    *{box-sizing:border-box}
    body{
      margin:0; font-family: "Inter", ui-sans-serif, system-ui, Arial; 
      background:var(--bg); color:var(--ink);
      display:flex; justify-content:center; padding:32px;
    }
    .wrap{
      width:min(920px,100%); 
      background:var(--card);
      border:1px solid var(--border); border-radius:20px; 
      padding:26px;
      box-shadow:0 15px 40px rgba(0,0,0,.5);
    }
    h1{
      margin:0 0 14px; 
      color:var(--accent); 
      font-size:24px; 
      letter-spacing:.5px; 
      font-weight:700;
    }
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin:12px 0 18px}
    input[type=text]{
      flex:1; min-width:220px; padding:13px 15px; 
      border-radius:12px; border:1px solid var(--border); 
      background:#0d0d0d; 
      color:var(--ink); outline:none;
      transition:all .2s ease;
    }
    input[type=text]:focus{
      border-color:var(--accent); box-shadow:0 0 0 2px rgba(59,130,246,.3);
    }
    button{
      padding:12px 18px; border-radius:12px; 
      border:1px solid transparent; 
      background:var(--accent); 
      color:#fff; font-weight:600; cursor:pointer;
      transition:all .2s ease;
    }
    button:hover:not(:disabled){ 
      background:#2563eb; 
    }
    button.secondary{ 
      background:transparent; 
      border-color:var(--border); 
      color:var(--ink); 
    }
    button.secondary:hover:not(:disabled){ 
      background:var(--hover);
    }
    button:disabled{ opacity:.5; cursor:not-allowed }
    label.small{ color:var(--muted); font-size:14px; display:flex; align-items:center; gap:8px }
    .meta{ color:var(--muted); font-size:14px; margin:2px 0 14px }
    .list{
      background:#0d0d0d; border:1px solid var(--border); 
      border-radius:16px; padding:12px; 
      max-height:520px; overflow:auto;
    }
    .item{ 
      padding:12px 14px; border-bottom:1px solid #1e293b; 
      word-break:break-word; 
      transition:background .2s;
    }
    .item:hover{
      background:var(--hover);
    }
    .item:last-child{border-bottom:none}

    /* FIX: subdomain link jadi putih */
    .item a {
      color: white !important;
      text-decoration: none;
    }
    .item a:hover {
      color: white !important;
      text-decoration: underline;
    }

    .badge{
      display:inline-block; 
      font-size:12px; 
      color:#fff; 
      padding:3px 9px; border-radius:999px; 
      margin-left:6px;
      font-weight:600;
    }
    .badge.checking{ background:#6b7280; } /* abu */
    .badge.a{ background:#22c55e; }       /* hijau */
    .badge.aaaa{ background:#a855f7; }    /* ungu */
    .badge.nx{ background:#ef4444; }      /* merah */
    .footer{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap}
    .hint{font-size:12px; color:#6b7280; margin-top:8px}
    .spinner{
      display:inline-block; width:16px; height:16px; 
      border:2px solid var(--accent); border-right-color:transparent; 
      border-radius:50%; animation:sp .8s linear infinite
    }
    @keyframes sp{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ðŸ”Ž Subdomain Finder <span class="badge" style="background:var(--accent)">OTX</span></h1>
    <div class="row">
      <input id="domain" type="text" placeholder="example.com" />
      <button id="btnFind" onclick="run()">Find</button>
      <button class="secondary" id="btnCopy" onclick="copyList()" disabled>Copy</button>
      <button class="secondary" id="btnSave" onclick="saveTxt()" disabled>Export .txt</button>
    </div>
    <div class="row" style="gap:16px">
      <label class="small"><input type="checkbox" id="verify" /> Verify DNS (A/AAAA)</label>
      <span class="meta" id="status">Ready.</span>
    </div>

    <div class="list" id="results">
      <div class="item">Enter a domain and click <b>Find</b>.</div>
    </div>

    <div class="hint">
      Sources: AlienVault OTX <code>/subdomains</code> & <code>/passive_dns</code>. DNS verify uses Google DoH.
    </div>
  </div>

<!-- script tetap sama -->
<script>
const el = (id) => document.getElementById(id);
let currentSubs = [];

function normDomain(d){
  return d.toLowerCase().trim()
    .replace(/^https?:\/\//,'')
    .replace(/\/.*$/,'')
    .replace(/^\./,'');
}

async function fetchJSON(url){
  const res = await fetch(url, {headers:{'Accept':'application/json'}});
  if(!res.ok) throw new Error(`HTTP ${res.status}`);
  return res.json();
}

function uniq(arr){ return [...new Set(arr)] }

function onlySubOf(domain){
  const suf = '.'+domain;
  return (h) => h && h.toLowerCase().endsWith(suf) && h.toLowerCase() !== domain;
}

function render(list, verifying=false){
  const box = el('results');
  if(list.length === 0){
    box.innerHTML = `<div class="item">No subdomains found.</div>`;
    return;
  }
  box.innerHTML = list.map(s => {
    const id = `chk-${btoa(s).replace(/=/g,'')}`;
    return `<div class="item">
      <a href="https://${s}" target="_blank" rel="noopener">${s}</a>
      ${verifying ? ` <span id="${id}" class="badge checking">checkingâ€¦</span>` : ''}
    </div>`;
  }).join('');
}

async function verifyDNS(host){
  try {
    const make = (type) => `https://dns.google/resolve?name=${encodeURIComponent(host)}&type=${type}`;
    const a = await fetch(make('A'));
    const aJ = a.ok ? await a.json() : null;
    if(aJ && aJ.Answer && aJ.Answer.length) return {ok:true, type:'A'};

    const aaaa = await fetch(make('AAAA'));
    const v6 = aaaa.ok ? await aaaa.json() : null;
    if(v6 && v6.Answer && v6.Answer.length) return {ok:true, type:'AAAA'};

    return {ok:false};
  } catch { return {ok:false} }
}

function setBusy(b){
  el('btnFind').disabled = b;
  el('btnCopy').disabled = b || currentSubs.length===0;
  el('btnSave').disabled = b || currentSubs.length===0;
}

async function run(){
  const raw = el('domain').value;
  const domain = normDomain(raw);
  if(!domain){ alert('Masukkan domain, contoh: example.com'); return; }

  currentSubs = [];
  setBusy(true);
  const wantVerify = el('verify').checked;
  el('status').innerHTML = `Querying OTX <span class="spinner"></span>`;

  try{
    const url1 = `https://otx.alienvault.com/api/v1/indicators/domain/${encodeURIComponent(domain)}/subdomains?limit=500`;
    let subs1 = [];
    try {
      const j1 = await fetchJSON(url1);
      subs1 = (j1.subdomains || []).map(s => s + '.' + domain);
    } catch(e){}

    const url2 = `https://otx.alienvault.com/api/v1/indicators/domain/${encodeURIComponent(domain)}/passive_dns`;
    let subs2 = [];
    try {
      const j2 = await fetchJSON(url2);
      subs2 = (j2.passive_dns || []).map(e => e.hostname).filter(Boolean);
    } catch(e){}

    const all = uniq([...subs1, ...subs2])
      .map(s => s?.toLowerCase().trim())
      .filter(Boolean)
      .filter(onlySubOf(domain))
      .sort((a,b)=>a.localeCompare(b));

    currentSubs = all;
    el('status').textContent = `Found ${all.length} subdomains.`;
    render(all, wantVerify);

    if(wantVerify && all.length){
      el('status').innerHTML = `Verifying DNS (${all.length}) <span class="spinner"></span>`;
      for(const s of all){
        const id = `chk-${btoa(s).replace(/=/g,'')}`;
        const badge = document.getElementById(id);
        if(!badge) continue;
        const vr = await verifyDNS(s);
        if(vr.ok){
          if(vr.type === "A"){
            badge.textContent = "A";
            badge.className = "badge a";
          }else{
            badge.textContent = "AAAA";
            badge.className = "badge aaaa";
          }
        }else{
          badge.textContent = "NX";
          badge.className = "badge nx";
        }
        await new Promise(r=>setTimeout(r,35));
      }
      el('status').textContent = `Found ${all.length} subdomains. DNS verification done.`;
    }
  }catch(err){
    console.error(err);
    el('status').textContent = `Error: ${err.message || err}`;
    el('results').innerHTML = `<div class="item">Request failed. Try again later.</div>`;
  }finally{
    setBusy(false);
  }
}

function copyList(){
  if(!currentSubs.length) return;
  const text = currentSubs.join('\n');
  navigator.clipboard.writeText(text).then(()=>{
    el('status').textContent = `Copied ${currentSubs.length} lines to clipboard.`;
  }).catch(()=>{
    el('status').textContent = `Copy failed.`;
  });
}

function saveTxt(){
  if(!currentSubs.length) return;
  const blob = new Blob([currentSubs.join('\n')], {type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `subdomains_${(el('domain').value||'domain').replace(/[^a-z0-9.-]+/gi,'_')}.txt`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(a.href), 1500);
}
</script> 
</body>
</html>
